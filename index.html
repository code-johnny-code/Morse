<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Awesome Morse</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<table id="key-table" class="keys">
  <tr id="first-row"></tr>
  <tr id="second-row"></tr>
</table>

<form class="keys">
  <input type="text" id="manual-input">
  <input type="submit" value="Play Morse">
</form>

<script src="alphabet.js"></script>
<script>

  function removeTransition(e) {
      if (e.propertyName !== 'transform') return;
      e.target.classList.remove('playing');
  }

  var audioEnabled = true;
  function playSound(e) {
      if (audioEnabled) {
          const audio = document.querySelector(`audio[data-key="${e.keyCode}"]`);
          const key = document.querySelector(`[data-key="${e.keyCode}"]`);
          if (!audio) return;

          key.classList.add('playing');
          audio.currentTime = 0;
          audio.play();
      }
  }

  var i = 0;
  for (var letter in alphabet) {
      var newTD = document.createElement('td');
      newTD.setAttribute("data-key",alphabet[letter]["key"]);
      newTD.className = "key";
      var newKbd = document.createElement('kbd');
      newKbd.innerHTML = letter;
      var newSpan = document.createElement('span');
      newSpan.className = "sound";
      newSpan.innerHTML = alphabet[letter]["spoken"] + '<br>' + alphabet[letter]["code"];
      var newAudio = document.createElement("audio");
      newAudio.setAttribute("data-key",alphabet[letter]["key"]);
      newAudio.src = alphabet[letter]["audio"];
      newTD.appendChild(newKbd);
      newTD.appendChild(newSpan);
      newTD.appendChild(newAudio);
      if (i <= 12) {
          document.getElementById("first-row").appendChild(newTD);
      }
      else {
          document.getElementById("second-row").appendChild(newTD);
      }
      i++;
  }
  const keys = Array.from(document.querySelectorAll('.key'));
  keys.forEach(function(key) {
      key.addEventListener('transitionend', removeTransition)
  });
  window.addEventListener('keydown', playSound);
  var textBox = document.getElementById("manual-input");
  textBox.onfocus = function(){audioEnabled = false};
  textBox.onblur = function () {audioEnabled = true};


</script>

</body>
</html>
